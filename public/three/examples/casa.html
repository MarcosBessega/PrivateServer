<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - collada</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				font-family: Monospace;
				background-color: #000000;
				margin: 0px;
				overflow: hidden;
			}

			#info {
				color: #fff;
				position: absolute;
				top: 10px;
				width: 100%;
				text-align: center;
				z-index: 100;
				display:block;

			}

			a { color: skyblue }
			#tools{
				position: absolute;
				right: 0;
				top: 0;
				background-color: rgba(255,255,255,0.5);
				padding: 5px;
				text-align: center;
			}
			#tools button{
				display: inline-block;
				margin-top: 4px;
			}
			.btn-down{
				/*margin-left: -6px !important;*/
			}
		</style>
	</head>
	<body>
		<div id="info">

		</div>

		<div id="tools">
			<button onclick='rotateUp()' class='btn-up'>/\</button>
			<br>
			<button onclick='rotateLeft()' class='btn-left'><</button>
			<button onclick='rotateCenter()' class='btn-center'>O</button>
			<button onclick='rotateRight()' class='btn-right'>></button>
			<br>
			<button onclick='rotateDown()' class='btn-down'>\/</button>
			<br> <br>
			<button onclick='console.log(camera.position);'>CAM POSITION</button>
		</div>


		<script src="../build/three.js"></script>


		<script src="js/loaders/ColladaLoader.js"></script>
		<script src="js/loaders/OBJLoader.js"></script>
		<script src="js/loaders/DDSLoader.js"></script>
		<script src="js/loaders/MTLLoader.js"></script>
		<script src="js/controls/OrbitControls.js"></script>
		<script src="js/renderers/Projector.js"></script>
		<script src="js/Detector.js"></script>
		<script src="js/libs/stats.min.js"></script>

		<script>

		function rotateUp(){
			camera.position.x = 0;
			camera.position.z=-15;
			camera.position.y=0;
		}

		function rotateDown(){
			camera.position.x = 0;
			camera.position.z=15;
			camera.position.y=0;
		}

		function rotateLeft(){
			camera.position.x = -14;
			camera.position.z=0;
			camera.position.y=0;
		}

		function rotateRight(){
			camera.position.x = 14;
			camera.position.z=0;
			camera.position.y=0;
		}

		function rotateCenter(){
			camera.position.x =0;
			camera.position.z=0;
			camera.position.y=10;
		}

			if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

			var container, stats;

			var camera, scene, renderer, objects,cameraControls;
			var cameraCube, sceneCube;
			var textureEquirec, textureCube, textureSphere;
			var cubeMesh, sphereMesh;
			var sphereMaterial;
			var refract;
			var light;
			var dae;
			var clickInfo = {
			  x: 0,
			  y: 0,
			  userHasClicked: false
			};

		    var raycaster = new THREE.Raycaster();
			var projector = new THREE.Projector();
			var directionVector = new THREE.Vector3();

			var SCREEN_HEIGHT = window.innerHeight;
			var SCREEN_WIDTH = window.innerWidth;

			// var loader = new THREE.ColladaLoader();
			// loader.options.convertUpAxis = true;
			// loader.load( 'teste.dae', function ( collada ) {

			// 	dae = collada.scene;
			// 	dae.name = 'dae';
			// 	dae.position.x = -3;
			// 	dae.position.z = 6;


			// 	dae.updateMatrix();
			// 	init();
			// 	animate();



			// } );


			function loadObj(){
				THREE.Loader.Handlers.add( /\.dds$/i, new THREE.DDSLoader() );
				var mtlLoader = new THREE.MTLLoader();
				mtlLoader.setPath( 'g/' );
				mtlLoader.load( 'gears-of-war-3-lambent-female.mtl', function( materials ) {
					materials.preload();
					var objLoader = new THREE.OBJLoader();
					objLoader.setMaterials( materials );
					objLoader.setPath( 'g/' );
					objLoader.load( 'gears-of-war-3-lambent-female.obj', function ( object ) {
						scene.add( object );
					} );
				});
				var mtlLoade2 = new THREE.MTLLoader();
				mtlLoade2.setPath( 'a/' );
				mtlLoade2.load( 'assassins-creed-altair.mtl', function( materials ) {
					materials.preload();
					var objLoader2 = new THREE.OBJLoader();
					objLoader2.setMaterials( materials );
					objLoader2.load( 'a/assassins-creed-altair.obj', function ( object ) {
						object.position.x = 4;
						object.scale.set(0.03,0.03,0.03);
						scene.add( object );
					} );
				});
				var mtlLoade3 = new THREE.MTLLoader();
				mtlLoade3.setPath( 'l/' );
				mtlLoade3.load( 'light-cruiser-tenryuu.mtl', function( materials ) {
					materials.preload();
					var objLoader2 = new THREE.OBJLoader();
					objLoader2.setMaterials( materials );
					objLoader2.load( 'l/light-cruiser-tenryuu.obj', function ( object ) {
						object.position.x = -4;
						object.rotation.y = Math.PI / 1.3;
						object.scale.set(2.3,2.3,2.3);
						scene.add( object );
					} );
				});

	
					var loader = new THREE.OBJLoader();
					// loader.load('estrutura_principal.obj',function ( object ) {
					// 		// dae.rotation.y = Math.PI;
					// 		 // dae.rotation.z = Math.PI;
					// 		 // object.position.y = -2.3;
					// 		//  object.position.z = 1;
					// 		// object.position.x = 2;
					// 		// dae.rotation.x = Math.PI;
					// 		 object.rotation.x = -Math.PI / 2;
					// 		 object.rotation.z = Math.PI;
					// 		var bb = new THREE.Box3()
					// 		bb.setFromObject(object);
					// 		var bsize = bb.size();
					// 		console.log(bsize);
					// 		var x = bsize.x;
					// 		var y = bsize.y;
					// 		var z = bsize.z;
					// 		// camera.lookAt(object);
					// 		// camera.position.x = x;
					// 		 object.position.x = -(bsize.x/5);
					// 		// camera.position.y = x;
					// 		camera.position.z = bsize.x;
					// 		console.log(x);
					// 		console.log(y);
					// 		console.log(z);
					// 		console.log(camera.position);

					// 		 setMaterial(object);
					// 		scene.add(object);
							 
							
					// 		// var position = new THREE.Vector3();
					// 		// var pos = position.setFromMatrixPosition( dae.children[0].matrixWorld );
					// 		// cameraControls.target.set(pos);
					// 		// camera.lookAt( pos );
					// 		// console.log(pos)
					// 	});
						// loader.load('mesa_0.obj',function ( object ) {
						// 	 object.rotation.x = -Math.PI / 2;
						// 	 object.rotation.z = Math.PI;
						// 	var bb = new THREE.Box3()
						// 	bb.setFromObject(object);
						// 	var bsize = bb.size();
						// 	console.log(bsize);
						// 	var x = bsize.x;
						// 	var y = bsize.y;
						// 	var z = bsize.z;

						// 	console.log(x);
						// 	console.log(y);
						// 	console.log(z);
						// 	console.log(camera.position);

						// 	 setMaterial(object);
						// 	 var mesa2 = object.clone();
						// 	 mesa2.position.x = 4;
						// 	 scene.add(mesa2);
						// 	 var mesa3 = object.clone();
						// 	 mesa3.position.x = -4;
						// 	 scene.add(mesa3);
						// 	scene.add(object);
							 
							

						// });
						loader.load('estrutura_principal.obj',function ( object ) {
							 object.rotation.x = -Math.PI / 2;
							 object.rotation.z = Math.PI;
							var bb = new THREE.Box3()
							bb.setFromObject(object);
							var bsize = bb.size();
							console.log(bsize);
							var x = bsize.x;
							var y = bsize.y;
							var z = bsize.z;
							// camera.lookAt(object);
							 object.position.x = -x/4;
							 // object.position.x = -(bsize.x/5);
							// camera.position.y = x;
							camera.position.z = bsize.x;
							console.log(x);
							console.log(y);
							console.log(z);
							console.log(camera.position);

							 setMaterial(object);
							scene.add(object);
							 
							
							// var position = new THREE.Vector3();
							// var pos = position.setFromMatrixPosition( dae.children[0].matrixWorld );
							// cameraControls.target.set(pos);
							// camera.lookAt( pos );
							// console.log(pos)
						});
				
			}


			
			init();
			animate();




			function init() {

				container = document.createElement( 'div' );
				document.body.appendChild( container );

				camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 500 );
				camera.position.set( 0, 1, 15 );


				scene = new THREE.Scene();
				var axisHelper = new THREE.AxisHelper( 50 );
				scene.add( axisHelper );
				console.log('red => X, green => Y, blue => Z');

				// Grid

				var size = 50, step = 1;

				// var geometry = new THREE.Geometry();
				// var material = new THREE.LineBasicMaterial( { color: 0x303030 } );

				// for ( var i = - size; i <= size; i += step ) {

				// 	geometry.vertices.push( new THREE.Vector3( - size, - 0.04, i ) );
				// 	geometry.vertices.push( new THREE.Vector3(   size, - 0.04, i ) );

				// 	geometry.vertices.push( new THREE.Vector3( i, - 0.04, - size ) );
				// 	geometry.vertices.push( new THREE.Vector3( i, - 0.04,   size ) );

				// }

				// var line = new THREE.LineSegments( geometry, material );
				//  scene.add( line );
				var tloader = new THREE.TextureLoader();

				tloader.load('ground.jpg',function(texture){
					var ground = new THREE.Mesh( new THREE.PlaneGeometry(80,
				80 ),
				new THREE.MeshLambertMaterial(
				{ map: texture }
				)
				);
				ground.rotation.x = -Math.PI/2;
				// ground.position.y = -.02 + 50;
				scene.add( ground );
				})
				












				



				renderer = new THREE.WebGLRenderer();
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.setClearColor(0xD7EFF5, 1);
				container.appendChild( renderer.domElement );

				stats = new Stats();
				container.appendChild( stats.dom );
				var position = new THREE.Vector3();

				cameraControls  = new THREE.OrbitControls( camera, renderer.domElement );
				 
				 cameraControls.minDistance = 10;
                  cameraControls.maxDistance = 210;
                  cameraControls.userRotateSpeed = 100;
                  cameraControls.enableZoom = true;
                  cameraControls.addEventListener( 'change', render );



				light = new THREE.DirectionalLight( 0xFE4545 );
				light.position.set( -2, -2, -2 );
				scene.add( light );
				light = new THREE.DirectionalLight( 0xffffff );
				light.position.set( 3, 3, 3 );
				scene.add( light );
				light = new THREE.AmbientLight( 0xffffff );
				scene.add( light );
				// document.addEventListener('mousedown', onMouseDown, false);
				window.addEventListener( 'resize', onWindowResize, false );
				// document.addEventListener('click', function(event){
			 //    var intersectObj = mouse.getIntersects( camera, scene.children, event)[0];
			 //        console.log(intersectObj);
			 //    });

				loadObj();

				// document.addEventListener('click', function (evt) {
				// 	var position = new THREE.Vector3();
				// 			var pos = position.setFromMatrixPosition( dae.children[0].matrixWorld );
				// 			console.log(pos);
				//   clickInfo.userHasClicked = true;
				//   clickInfo.x = evt.clientX;
				//   clickInfo.y = evt.clientY;
				// }, false);


			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			//

			function animate() {
				requestAnimationFrame( animate );
				cameraControls.update();
				stats.update();
				render();
			}


			function render() {
				if(clickInfo.userHasClicked){		
					var x = ( clickInfo.x / SCREEN_WIDTH ) * 2 - 1;
					var y = -( clickInfo.y / SCREEN_HEIGHT ) * 2 + 1;
					var vector = new THREE.Vector3( x, y, 1 );
					raycaster.setFromCamera( vector, camera );
					var intersects = raycaster.intersectObjects(scene.children, true);
					if (intersects.length) {
					  var target = intersects[0].object;
					  // console.log(dae);
					  	console.log(target);
					   target.material.color.setHex( Math.random() * 0xffffff );
					   var toPrint = 'Conjunto '+target.name+' Clickado.';
					   document.getElementById('info').innerHTML = toPrint;

					 
					}
					clickInfo.userHasClicked = false;
				}

				renderer.render( scene, camera );
			}






			var mouse = {
		    getIntersects: function( camera, sceneChildren, event ){
		    	var toIntersect = [];
		    	THREE.SceneUtils.traverse(dae, function (child) {
				    if (child instanceof THREE.Mesh) {
				        toIntersect.push(child);
				    }
				});
				console.log(toIntersect);
		        event = event || window.event;

		        var mouseX = ( event.clientX / window.innerWidth ) * 2 - 1;
		        var mouseY = -( event.clientY / window.innerHeight ) * 2 + 1;

		        var vector = new THREE.Vector3( mouseX, mouseY, camera.near );
		            vector.unproject( camera );

		        var raycaster = new THREE.Raycaster( camera.position, vector.sub( camera.position ).normalize() );

		        var intersects = raycaster.intersectObjects( sceneChildren );

		        if ( intersects.length > 0 ) {
		            //console.log(intersects);
		            return intersects;
		        }
		        return false;
		    },

		    Position3D: function(sceneChildren){
		        var intersects = mouse.getIntersects( sceneChildren );
		        return intersects[0].point
		    }
		}









		var setMaterial = function(node, material) {
			// console.log(node);
			var cor = Math.random() * 0xffffff;
		  node.material = new THREE.MeshBasicMaterial({color: cor});
		  if (node.children) {
		    for (var i = 0; i < node.children.length; i++) {
		      setMaterial(node.children[i], new THREE.MeshBasicMaterial({color: cor}));
		    }
		  }
		}

		</script>
	</body>
</html>
